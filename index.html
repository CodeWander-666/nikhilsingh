<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIKHIL SINGH | 4D REALITY</title>
    <style>
        /* --- HIGH-END CSS STYLING --- */
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;500;700&display=swap');

        :root {
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --neon: #00f3ff;
        }

        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Rajdhani', sans-serif; color: #fff; }
        canvas { display: block; width: 100vw; height: 100vh; }

        #ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; padding: 40px; box-sizing: border-box;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* HUD Header */
        header {
            display: flex; justify-content: space-between; align-items: flex-end;
            border-bottom: 1px solid var(--border); padding-bottom: 20px;
        }
        h1 { margin: 0; font-size: 3rem; letter-spacing: 5px; text-transform: uppercase; mix-blend-mode: overlay; }
        .status-badge {
            font-size: 0.8rem; background: var(--glass); padding: 5px 10px;
            border: 1px solid var(--neon); color: var(--neon);
        }

        /* Project Cards (Fetched from Java) */
        #project-dock {
            pointer-events: auto;
            display: flex; gap: 20px; overflow-x: auto; padding-bottom: 20px;
        }
        .holo-card {
            min-width: 250px; background: var(--glass); border: 1px solid var(--border);
            padding: 20px; backdrop-filter: blur(10px); transition: 0.3s;
            cursor: pointer; transform: skewX(-10deg);
        }
        .holo-card:hover { border-color: var(--neon); background: rgba(0, 243, 255, 0.1); }
        .holo-card h3 { margin: 0 0 10px 0; color: var(--neon); }
        .holo-card p { font-size: 0.8rem; color: #aaa; }

        /* AI Debug Info */
        #ai-debug {
            position: absolute; top: 100px; right: 40px; text-align: right;
            font-family: monospace; font-size: 0.7rem; color: #555;
        }
        .param-row { margin-bottom: 5px; }

        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            letter-spacing: 10px; animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

    </style>
</head>
<body>

    <div id="loading">CONNECTING TO NEURAL CORE...</div>

    <div id="ui-overlay">
        <header>
            <div>
                <h1 id="profile-name">LOADING...</h1>
                <div style="opacity: 0.6;" id="profile-title">SYSTEM BOOT</div>
            </div>
            <div class="status-badge">JAVA BACKEND: CONNECTED</div>
        </header>

        <div id="ai-debug">
            <div class="param-row">AI_ENGINE: <span style="color:var(--neon)">PYTHON_FLASK</span></div>
            <div class="param-row">DISTORTION: <span id="debug-dist">0.00</span></div>
            <div class="param-row">VOLATILITY: <span id="debug-vol">0.00</span></div>
        </div>

        <div id="project-dock">
            </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

    <script>
        // --- 1. CONNECT TO BACKENDS ---
        const JAVA_API = 'http://localhost:8080/api';
        const PYTHON_API = 'http://localhost:5000/api';

        async function initSystem() {
            try {
                // Fetch Profile (Java)
                // Note: For demo without running backend, we use mock data fallback
                try {
                    const profileRes = await fetch(`${JAVA_API}/profile`);
                    const profile = await profileRes.json();
                    document.getElementById('profile-name').innerText = profile.name;
                    document.getElementById('profile-title').innerText = profile.title;
                } catch(e) {
                    console.log("Java Backend Offline - Using Mock Data");
                    document.getElementById('profile-name').innerText = "NIKHIL SINGH";
                    document.getElementById('profile-title').innerText = "AI ARCHITECT // OFFLINE MODE";
                }

                // Fetch Projects (Java)
                const projects = [
                    { name: "NOVUSFACE", desc: "4K Face Swap Engine", type: "AI" },
                    { name: "TUBEMAN", desc: "Video Extraction Bot", type: "TOOL" },
                    { name: "SEOMAN", desc: "Rank Warfare Suite", type: "SEO" }
                ]; 
                
                const dock = document.getElementById('project-dock');
                projects.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'holo-card';
                    card.innerHTML = `<h3>${p.name}</h3><p>${p.desc}</p>`;
                    card.onclick = () => triggerGlitch(2.0); // Interaction triggers AI effect
                    dock.appendChild(card);
                });

                document.getElementById('loading').style.display = 'none';

            } catch (err) {
                console.error("System Failure", err);
            }
        }

        initSystem();

        // --- 2. THE VISUAL ENGINE (THREE.JS) ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- LIQUID METAL SHADER ---
        const uniforms = {
            time: { value: 0 },
            distortion: { value: 0.0 },
            color: { value: new THREE.Color(0x00f3ff) }
        };

        const material = new THREE.ShaderMaterial({
            uniforms: uniforms,
            wireframe: true,
            vertexShader: `
                uniform float time;
                uniform float distortion;
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    vec3 pos = position;
                    // AI DRIVEN DISTORTION
                    float wave = sin(pos.y * 5.0 + time) * distortion;
                    float twist = cos(pos.x * 5.0 + time) * distortion;
                    pos.x += wave;
                    pos.z += twist;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                }
            `,
            fragmentShader: `
                uniform vec3 color;
                varying vec2 vUv;
                void main() {
                    gl_FragColor = vec4(color, 1.0);
                }
            `
        });

        const geo = new THREE.IcosahedronGeometry(2, 10);
        const mesh = new THREE.Mesh(geo, material);
        scene.add(mesh);

        // --- POST PROCESSING (BLOOM) ---
        const composer = new THREE.EffectComposer(renderer);
        const renderPass = new THREE.RenderPass(scene, camera);
        composer.addPass(renderPass);
        const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        composer.addPass(bloomPass);

        // --- 3. AI UPDATE LOOP (PYTHON CONNECTION) ---
        let targetDistortion = 0.5;
        
        // Poll Python Backend for visual parameters
        setInterval(async () => {
            try {
                const res = await fetch(`${PYTHON_API}/visual-effects`);
                const aiData = await res.json();
                
                // Update Visuals based on Python AI
                targetDistortion = aiData.liquid_volatility;
                uniforms.color.value.setRGB(aiData.color_palette.r, aiData.color_palette.g, aiData.color_palette.b);
                
                // Update Debug UI
                document.getElementById('debug-dist').innerText = aiData.glitch_intensity.toFixed(2);
                document.getElementById('debug-vol').innerText = aiData.liquid_volatility.toFixed(2);
                
            } catch(e) {
                // Fallback if Python is offline
                targetDistortion = (Math.sin(Date.now()*0.001)+1)/2;
            }
        }, 1000);

        function triggerGlitch(intensity) {
            uniforms.distortion.value = intensity;
            setTimeout(() => uniforms.distortion.value = targetDistortion, 200);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now() * 0.001;
            
            uniforms.time.value = time;
            // Smoothly interpolate distortion
            uniforms.distortion.value += (targetDistortion - uniforms.distortion.value) * 0.05;
            
            mesh.rotation.y = time * 0.2;
            mesh.rotation.x = time * 0.1;

            composer.render();
        }
        animate();

        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
